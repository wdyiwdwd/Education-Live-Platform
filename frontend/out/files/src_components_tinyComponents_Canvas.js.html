<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/components/tinyComponents/Canvas.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-elements">Elements</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Actions.html">Actions</a></li>
                                <li><a href="../classes/Canvas.html">Canvas</a></li>
                                <li><a href="../classes/CanvasInfo.html">CanvasInfo</a></li>
                                <li><a href="../classes/Chat.html">Chat</a></li>
                                <li><a href="../classes/Checks.html">Checks</a></li>
                                <li><a href="../classes/CloseButton.html">CloseButton</a></li>
                                <li><a href="../classes/CodeMirror.html">CodeMirror</a></li>
                                <li><a href="../classes/Const.html">Const</a></li>
                                <li><a href="../classes/Getters.html">Getters</a></li>
                                <li><a href="../classes/Home.html">Home</a></li>
                                <li><a href="../classes/Index.html">Index</a></li>
                                <li><a href="../classes/Live.html">Live</a></li>
                                <li><a href="../classes/LogIn.html">LogIn</a></li>
                                <li><a href="../classes/Mp4Player.html">Mp4Player</a></li>
                                <li><a href="../classes/PPT.html">PPT</a></li>
                                <li><a href="../classes/Progress.html">Progress</a></li>
                                <li><a href="../classes/ProgressBar.html">ProgressBar</a></li>
                                <li><a href="../classes/Room.html">Room</a></li>
                                <li><a href="../classes/SignUp.html">SignUp</a></li>
                                <li><a href="../classes/StudentRTC.html">StudentRTC</a></li>
                                <li><a href="../classes/Studio.html">Studio</a></li>
                                <li><a href="../classes/TeacherRTC.html">TeacherRTC</a></li>
                                <li><a href="../classes/Topbar.html">Topbar</a></li>
                                <li><a href="../classes/UploadButton.html">UploadButton</a></li>
                                <li><a href="../classes/Utils.html">Utils</a></li>
                                <li><a href="../classes/Verification.html">Verification</a></li>
                                <li><a href="../classes/Welcome.html">Welcome</a></li>
                            </ul>
                
                                <ul id="api-elements" class="apis elements">
                                    <li><a href="../elements/CREATORID.html">&lt;CREATORID&gt;</a></li>
                                    <li><a href="../elements/HEIGHT.html">&lt;HEIGHT&gt;</a></li>
                                    <li><a href="../elements/WIDTH.html">&lt;WIDTH&gt;</a></li>
                                </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/Store.html">Store</a></li>
                                <li><a href="../modules/TinyComponents.html">TinyComponents</a></li>
                                <li><a href="../modules/Utils.html">Utils</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/components/tinyComponents/Canvas.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&lt;template&gt;
	&lt;div id=&quot;canvas&quot; ref=&quot;canvas&quot;&gt;
        &lt;div id=&quot;relative&quot; @mouseenter=&quot;showToolBar()&quot; @mouseleave=&quot;hideToolBar()&quot;&gt;
            &lt;Button type=&quot;ghost&quot; :size=&quot;SIZE&quot; shape=&quot;circle&quot; icon=&quot;wrench&quot; id=&quot;tool-button&quot;&gt;&lt;/Button&gt;
        &lt;/div&gt;
		&lt;!--div :style=&quot;btnPosition&quot; id=&quot;show-tool&quot; ref=&quot;showTool&quot;  @mouseenter=&quot;showToolBar()&quot; @mouseleave=&quot;hideToolBar()&quot;&gt;
			&lt;Button type=&quot;ghost&quot; :size=&quot;SIZE&quot; shape=&quot;circle&quot; icon=&quot;wrench&quot; id=&quot;tool-button&quot;&gt;&lt;/Button&gt;
		&lt;/div--&gt;
		&lt;Row &gt;
		&lt;div ref=&quot;toolbar&quot; id=&quot;tool-bar&quot; :style=&quot;toolBarPosition&quot; v-if=&quot;this.toolBar&quot; @mouseenter=&quot;showToolBar()&quot; @mouseleave=&quot;hideToolBar()&quot;&gt;
			&lt;Poptip trigger=&quot;hover&quot; content=&quot;choose pen&quot; placement=&quot;top&quot;  class=&quot;buttons&quot;&gt;
				&lt;Button :size=&quot;SIZE&quot; :type=&quot;checkType(&#x27;pen&#x27;)&quot; shape=&quot;circle&quot; icon=&quot;edit&quot; @click=&quot;changeType(&#x27;pen&#x27;)&quot; class=&quot;buttons&quot; :Disabled=&quot;!AUTHORITY&quot;&gt;&lt;/Button&gt;
			&lt;/Poptip&gt;
			&lt;Poptip trigger=&quot;hover&quot; content=&quot;choose line&quot; placement=&quot;top&quot;   class=&quot;buttons&quot;&gt;
				&lt;Button :size=&quot;SIZE&quot; :type=&quot;checkType(&#x27;line&#x27;)&quot; shape=&quot;circle&quot; icon=&quot;minus-round&quot; @click=&quot;changeType(&#x27;line&#x27;)&quot;  class=&quot;buttons&quot; :Disabled=&quot;!AUTHORITY&quot;&gt;&lt;/Button&gt;
			&lt;/Poptip&gt;
			&lt;Poptip trigger=&quot;hover&quot; content=&quot;choose rect&quot; placement=&quot;top&quot;   class=&quot;buttons&quot;&gt;
				&lt;Button :size=&quot;SIZE&quot; :type=&quot;checkType(&#x27;rect&#x27;)&quot; shape=&quot;circle&quot; icon=&quot;android-checkbox-outline-blank&quot; @click=&quot;changeType(&#x27;rect&#x27;)&quot; class=&quot;buttons&quot; :Disabled=&quot;!AUTHORITY&quot;&gt;&lt;/Button&gt;
			&lt;/Poptip&gt;
			&lt;Poptip trigger=&quot;hover&quot; content=&quot;choose circle&quot; placement=&quot;top&quot;   class=&quot;buttons&quot;&gt;
				&lt;Button :size=&quot;SIZE&quot; :type=&quot;checkType(&#x27;circle&#x27;)&quot; shape=&quot;circle&quot; icon=&quot;android-radio-button-off&quot; @click=&quot;changeType(&#x27;circle&#x27;)&quot; class=&quot;buttons&quot; :Disabled=&quot;!AUTHORITY&quot;&gt;&lt;/Button&gt;
			&lt;/Poptip&gt;
			&lt;Poptip trigger=&quot;hover&quot; content=&quot;choose rubber&quot; placement=&quot;top&quot;   class=&quot;buttons&quot;&gt;
				&lt;Button :size=&quot;SIZE&quot; :type=&quot;checkType(&#x27;rubber&#x27;)&quot; shape=&quot;circle&quot; icon=&quot;android-checkbox-blank&quot; @click=&quot;changeType(&#x27;rubber&#x27;)&quot; class=&quot;buttons&quot; :Disabled=&quot;!AUTHORITY&quot;&gt;&lt;/Button&gt;
			&lt;/Poptip&gt;
			&lt;Poptip trigger=&quot;hover&quot; content=&quot;choose text&quot; placement=&quot;top&quot;   class=&quot;buttons&quot;&gt;
				&lt;Button :size=&quot;SIZE&quot; :type=&quot;checkType(&#x27;text&#x27;)&quot; shape=&quot;circle&quot; icon=&quot;compose&quot; @click=&quot;changeType(&#x27;text&#x27;)&quot; class=&quot;buttons&quot; :Disabled=&quot;!AUTHORITY&quot;&gt;&lt;/Button&gt;
			&lt;/Poptip&gt;
			&lt;Poptip trigger=&quot;hover&quot; :content=&quot;getFill&quot; placement=&quot;top&quot;   class=&quot;buttons&quot;&gt;
				&lt;Button :size=&quot;SIZE&quot; :type=&quot;checkFill()&quot; shape=&quot;circle&quot; icon=&quot;android-star-half&quot; @click=&quot;changeFill()&quot; class=&quot;buttons&quot; :Disabled=&quot;!AUTHORITY&quot;&gt;&lt;/Button&gt;
			&lt;/Poptip&gt;
			&lt;br&gt;
			&lt;Poptip trigger=&quot;hover&quot; content=&quot;color picker&quot; placement=&quot;bottom&quot;   class=&quot;buttons&quot;&gt;
				&lt;Button :size=&quot;SIZE&quot; type=&quot;default&quot; shape=&quot;circle&quot; icon=&quot;android-color-palette&quot; @click=&quot;colorPicker()&quot;  class=&quot;buttons&quot; :Disabled=&quot;!AUTHORITY&quot;&gt;&lt;/Button&gt;
			&lt;/Poptip&gt;
			&lt;Poptip trigger=&quot;hover&quot; content=&quot;clear&quot; placement=&quot;bottom&quot;   class=&quot;buttons&quot;&gt;
				&lt;Button :size=&quot;SIZE&quot; type=&quot;default&quot; shape=&quot;circle&quot; icon=&quot;refresh&quot; @click=&quot;clearBoard()&quot;  class=&quot;buttons&quot; :Disabled=&quot;!AUTHORITY&quot;&gt;&lt;/Button&gt;
		    &lt;/Poptip&gt;
		    &lt;Poptip trigger=&quot;hover&quot; :content=&quot;getWidth&quot; placement=&quot;bottom&quot;   class=&quot;buttons&quot;&gt;
		    	&lt;Button :size=&quot;SIZE&quot; type=&quot;default&quot; shape=&quot;circle&quot; icon=&quot;plus&quot; @click=&quot;addWidth()&quot; class=&quot;buttons&quot; :Disabled=&quot;!AUTHORITY&quot;&gt;&lt;/Button&gt;
		    &lt;/Poptip&gt;
		    &lt;Poptip trigger=&quot;hover&quot; :content=&quot;getWidth&quot; placement=&quot;bottom&quot;   class=&quot;buttons&quot;&gt;
				&lt;Button :size=&quot;SIZE&quot; type=&quot;default&quot; shape=&quot;circle&quot; icon=&quot;minus&quot; @click=&quot;minusWidth()&quot; class=&quot;buttons&quot; :Disabled=&quot;!AUTHORITY&quot;&gt;&lt;/Button&gt;
			&lt;/Poptip&gt;
			&lt;Poptip trigger=&quot;hover&quot; :content=&quot;getFontSize&quot; placement=&quot;bottom&quot;   class=&quot;buttons&quot;&gt;
				&lt;Button :size=&quot;SIZE&quot; type=&quot;default&quot; shape=&quot;circle&quot; icon=&quot;plus-round&quot; @click=&quot;addFontSize()&quot;  class=&quot;buttons&quot; :Disabled=&quot;!AUTHORITY&quot;&gt;&lt;/Button&gt;
			&lt;/Poptip&gt;
			&lt;Poptip trigger=&quot;hover&quot; :content=&quot;getFontSize&quot; placement=&quot;bottom&quot;   class=&quot;buttons&quot;&gt;
				&lt;Button :size=&quot;SIZE&quot; type=&quot;default&quot; shape=&quot;circle&quot; icon=&quot;minus-round&quot; @click=&quot;minusFontSize()&quot; class=&quot;buttons&quot; :Disabled=&quot;!AUTHORITY&quot;&gt;&lt;/Button&gt;
			&lt;/Poptip&gt;
		&lt;/div&gt;
		&lt;Modal v-model=&quot;showColorPicker&quot; :width=&quot;250&quot; :closable=&quot;false&quot; id=&quot;modal&quot;&gt;
	        &lt;div style=&quot;text-align:center&quot;&gt;
	            &lt;color-picker v-model=&quot;canvas.color&quot;&gt;&lt;/color-picker&gt;
	        &lt;/div&gt;
	        &lt;div slot=&quot;footer&quot;&gt;&lt;/div&gt;
	    &lt;/Modal&gt;
	    &lt;Col span=&quot;24&quot; id=&quot;draw-board&quot;&gt;
			&lt;canvas ref=&quot;board&quot; id=&quot;board&quot;&gt;&lt;/canvas&gt;
			&lt;Input :on-keydown=&quot;testText()&quot; ref=&quot;text&quot; id=&quot;text&quot; v-model=&quot;canvas.text&quot; v-if=&quot;canvas.isInput&quot; autofocus :style=&quot;position&quot; type=&quot;textarea&quot; autosize&gt;&lt;/Input&gt;
		&lt;/Col&gt;
		&lt;/Row&gt;
	&lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
/**
 *Module TinyComponents
 *
 *@module TinyComponents
 *@requires Utils
 */
import { Sketch } from &#x27;vue-color&#x27;
import { wsConnect, wsSend, wsClose } from &#x27;../../utils/websockets&#x27;
import { makeCanvasInfo } from &#x27;../../utils/messages&#x27;
const defaultProps = {
    hex: &#x27;#194d33&#x27;,
    hsl: { h: 150, s: 0.5, l: 0.2, a: 1 },
    hsv: { h: 150, s: 0.66, v: 0.30, a: 1 },
    rgba: { r: 25, g: 77, b: 51, a: 1 },
    a: 1
}

/**
 *画板
 *@class Canvas
 *@constructor
 */
export default {
    components: {
        &#x27;color-picker&#x27;: Sketch
    },
    props: {
        WIDTH: {
            type: Number,
            default: 400
        },
        HEIGHT: {
            type: Number,
            default: 260
        },
        SIZE: {
            type: Number,
            default: &#x27;&#x27;
        },
        AUTHORITY: {
            type: Boolean,
            default: false
        }
    },
    watch: {
        &#x27;WIDTH&#x27;: function (newVal, oldVal) {
            console.log(newVal)
            let data = this.getHistory()
            this.$refs.board.width = this.WIDTH
            this.$refs.board.height = this.HEIGHT
            this.draw(data)
        }
    },
    data () {
        return {
            socket: null,
            toolBar: false,
            showColorPicker: false,
            types: [&#x27;pen&#x27;, &#x27;line&#x27;, &#x27;circle&#x27;, &#x27;rect&#x27;, &#x27;rubber&#x27;, &#x27;text&#x27;],
            type: &#x27;pen&#x27;,
            context: null,
            canvas: {
                width: 3,
                fontSize: 20,
                color: defaultProps,
                penOriginPoint: null,
                lastImageData: null,
                isFill: false,
                isInput: false,
                text: &#x27;&#x27;
            },
            position: {
                position: &#x27;absolute&#x27;,
                left: &#x27;30px&#x27;,
                top: &#x27;30px&#x27;,
                zIndex: 999,
                width: &#x27;100px&#x27;
            },
            btnPosition: {
                position: &#x27;absolute&#x27;,
                left: &#x27;30px&#x27;,
                top: &#x27;30px&#x27;,
                zIndex: 400
            },
            toolBarPosition: {
                position: &#x27;absolute&#x27;,
                zIndex: 999
            }
        }
    },
    computed: {
        /**
         *获得此时画布的宽度
         *@method getWidth
         *@return {String} &#x27;width: &#x27; + 画布的宽度
         */
        getWidth () {
            return &#x27;width: &#x27; + this.canvas.width.toString()
        },
        /**
         *获得此时字体的大小
         *@method getFontSize
         *@return {String} &#x27;fontSize: &#x27; + 字体的大小
         */
        getFontSize () {
            return &#x27;fontSize: &#x27; + this.canvas.fontSize.toString()
        },
        /**
         *获得此时是否要把图形的中心填满的参数
         *@method getFill
         *@return {String} 如果现在isFill的值为true，就返回&#x27;fill&#x27;,否则返回&#x27;stroke&#x27;
         */
        getFill () {
            return (this.canvas.isFill) ? &#x27;fill&#x27; : &#x27;stroke&#x27;
        }
    },
    methods: {
        /**
         *获得过去的操作生成的现在的图像
         *@method getHistory
         *@return {Object} 返回一个canvasInfo对象，更新属性type和canvas
         */
        getHistory () {
            return makeCanvasInfo({
                type: &#x27;history&#x27;,
                canvas: this.$refs.board.toDataURL(&#x27;image/png&#x27;)
            })
        },
        /**
         *发送清空画板的消息，发送的消息为一个canvasInfo对象，属性type为&#x27;clear&#x27;
         *@event reloadClear
         */
        reloadClear () {
            this.send(makeCanvasInfo({
                type: &#x27;clear&#x27;
            }))
        },
        /**
         *显示工具栏
         *@event showToolBar
         */
        showToolBar () {
            this.toolBar = true
        },
        /**
         *隐藏工具栏
         *@event hideToolBar
         */
        hideToolBar () {
            this.toolBar = false
        },
        /**
         *返回值对应的宽度的像素值
         *@method widthSliderFomat
         *@param val
         *@return {Object} &#x27;width: &#x27; + val + &#x27;px&#x27;
         */
        widthSliderFomat (val) {
            return &#x27;width: &#x27; + val + &#x27;px&#x27;
        },
        /**
         *返回值对应的字体大小的像素值
         *@method fontSliderFomat
         *@param val
         *@return {Object} &#x27;font: &#x27; + val + &#x27;px&#x27;
         */
        fontSliderFomat (val) {
            return &#x27;font: &#x27; + val + &#x27;px&#x27;
        },
        /**
         *显示颜色选择器
         *@event colorPicker
         */
        colorPicker () {
            this.showColorPicker = true
        },
        /**
         *检查现在的type和实际的type是否符合
         *@method checkType
         *@param type
         *@return {String} 返回代表相符合和不符合的两个字符串
         */
        checkType (type) {
            return (this.type === type) ? &#x27;primary&#x27; : &#x27;ghost&#x27;
        },
        /**
         *改变现在记录的type值
         *@event changeType
         *@param type
         */
        changeType (type) {
            this.type = type
        },
        /**
         *检查现在的isFill是否为真，及画的图形是否填充
         *@method checkFill
         *@return {String} 返回代表填充和不填充的两个字符串
         */
        checkFill () {
            return (this.canvas.isFill) ? &#x27;primary&#x27; : &#x27;ghost&#x27;
        },
        /**
         *修改现在的isFill值，如果现在为true，则赋值false;如果现在是false,那么赋值true
         *@event changeFill
         */
        changeFill () {
            this.canvas.isFill = !(this.canvas.isFill)
        },
        /**
         *笔触增大
         *@event addWidth
         */
        addWidth () {
            (this.canvas.width &lt; 24) ? (this.canvas.width++) : &#x27;&#x27;
        },
        /**
         *笔触减小
         *@event minusWidth
         */
        minusWidth () {
            (this.canvas.width &gt; 1) ? (this.canvas.width--) : &#x27;&#x27;
        },
        /**
         *字体增大
         *@event addFontSize
         */
        addFontSize () {
            (this.canvas.fontSize &lt; 35) ? (this.canvas.fontSize++) : &#x27;&#x27;
        },
        /**
         *字体减小
         *@event minusFontSize
         */
        minusFontSize () {
            (this.canvas.fontSize &gt; 15) ? (this.canvas.fontSize--) : &#x27;&#x27;
        },
        /**
         *发送信息
         *@event send
         *@param {Object} data
         */
        send (data) {
            this.$emit(&#x27;send&#x27;, data)
        },
        /**
         *接收信息,依据收到的消息对画板进行操作
         *@event receive
         *@param {Object} data
         */
        receive (data) {
            this.draw(data.data)
        },
        /**
         *如果&#x27;\n&#x27;的位置大于等于0，那么就调用函数putText
         *@event testText
         */
        testText () {
            if (this.canvas.text.indexOf(&#x27;\n&#x27;) &gt;= 0) {
                try {
                    this.putText()
                } catch (e) {
                    console.log(e)
                }
            }
        },
        /**
         *画直线
         *@event drawLine
         *@param {Number} ox，开始的x轴坐标
         *@param {Number} oy，开始的y轴坐标
         *@param {Number} ex，结束的x轴坐标
         *@param {Number} ey，结束的y轴坐标
         */
        drawLine (ox, oy, ex, ey) {
            const context = this.context
            context.beginPath()
            context.moveTo(ox, oy)
            context.lineTo(ex, ey)
            context.stroke()
            context.closePath()
        },
        /**
         *画圆
         *@event drawCircle
         *@param {Number} ox，开始的x轴坐标
         *@param {Number} oy，开始的y轴坐标
         *@param {Number} ex，结束的x轴坐标
         *@param {Number} ey，结束的y轴坐标
         *@param {Boolean} isFill,是否填充
         */
        drawCircle (ox, oy, ex, ey, isFill = false) {
            const context = this.context
            const [ dx, dy ] = [ ex - ox, ey - oy ]
            const [ cx, cy ] = [ (ex + ox) / 2, (ey + oy) / 2 ]
            const radius = (Math.sqrt(dx * dx + dy * dy)) / 2
            context.beginPath()
            context.arc(cx, cy, radius, 0, 2 * Math.PI, true);
            (isFill) ? context.fill() : context.stroke()
            context.closePath()
        },
        /**
         *画矩形
         *@event drawRect
         *@param {Number} ox，开始的x轴坐标
         *@param {Number} oy，开始的y轴坐标
         *@param {Number} ex，结束的x轴坐标
         *@param {Number} ey，结束的y轴坐标
         *@param {Boolean} isFill,是否填充
         */
        drawRect (ox, oy, ex, ey, isFill = false) {
            const context = this.context
            const [ dx, dy ] = [ ex - ox, ey - oy ]
            context.beginPath()
            context.rect(ox, oy, dx, dy);
            (isFill) ? context.fill() : context.stroke()
            context.closePath()
        },
        /**
         *在画板上显示输入的text
         *@event drawText
         *@param {Number} ox，开始的x轴坐标
         *@param {Number} oy，开始的y轴坐标
         *@param {Number} fontSize，字体大小
         *@param {String} text，输入的text
         *@param {Boolean} isFill,是否填充
         */
        drawText (ox, oy, fontSize, text, isFill = false) {
            this.context.font = fontSize.toString() + &#x27;px Georgia&#x27;;
            (isFill) ? this.context.fillText(text, ox, oy) : this.context.strokeText(text, ox, oy)
        },
        /**
         *操作清空画板
         *@event drawClear
         */
        drawClear () {
            this.context.clearRect(0, 0, this.WIDTH, this.HEIGHT)
        },
        /**
         *设置属性
         *@event setProperty
         *@param {Number} width
         *@param {String} color
         *@param {Number} alpha
         */
        setProperty (width, color, alpha) {
            const context = this.context
            context.strokeStyle = color
            context.fillStyle = color
            context.lineWidth = width
            context.globalAlpha = alpha
        },
        /**
         *初始化画笔的属性
         *@event initPenProperty
         */
        initPenProperty () {
            const context = this.context
            context.lineCap = &#x27;round&#x27;
            if (this.type === &#x27;pen&#x27; &amp;&amp; this.canvas.color.a &lt; 1) {
                context.lineCap = &#x27;butt&#x27;
            }
            if (this.type !== &#x27;text&#x27;) {
                this.canvas.isInput = false
            }
        },
        /**
         *实施画笔的操作
         *@event commandpen
         *@param {String} action，操作的名称，&#x27;mousemove&#x27;, &#x27;mousedown&#x27;, &#x27;mouseup&#x27;
         *@param {Object} { x, y, buttons }
         */
        commandpen (action, { x, y, buttons }) {
            this.initPenProperty()
            const canvas = this.canvas
            this.setProperty(canvas.width, canvas.color.hex, canvas.color.a)
            switch (action) {
                case &#x27;mousedown&#x27;:
                    this.canvas.penOriginPoint = [x, y]
                    break
                case &#x27;mousemove&#x27;:
                    if (buttons !== 1) {
                        return
                    }
                    const [ox, oy] = canvas.penOriginPoint
                    this.drawLine(ox, oy, x, y)
                    this.send(makeCanvasInfo({
                        type: this.type,
                        ox: ox / this.WIDTH,
                        oy: oy / this.HEIGHT,
                        ex: x / this.WIDTH,
                        ey: y / this.HEIGHT,
                        width: canvas.width / this.WIDTH,
                        color: canvas.color
                    }))
                    canvas.penOriginPoint = [x, y]
                    break
                case &#x27;mouseup&#x27;:
                    canvas.penOriginPoint = null
                    break
            }
        },
        /**
         *实施画直线的操作
         *@event commandline
         *@param {String} action，操作的名称，&#x27;mousemove&#x27;, &#x27;mousedown&#x27;, &#x27;mouseup&#x27;
         *@param {Object} { x, y, buttons }
         */
        commandline (action, { x, y, buttons }) {
            this.initPenProperty()
            const canvas = this.canvas
            this.setProperty(canvas.width, canvas.color.hex, canvas.color.a)
            switch (action) {
                case &#x27;mousedown&#x27;:
                    canvas.penOriginPoint = [x, y]
                    canvas.lastImageData = this.context.getImageData(0, 0, this.WIDTH, this.HEIGHT)
                    break
                case &#x27;mousemove&#x27;:
                    if (canvas.penOriginPoint == null) {
                        return
                    }
                    this.context.putImageData(canvas.lastImageData, 0, 0)
                    const [ ox, oy ] = canvas.penOriginPoint
                    this.drawLine(ox, oy, x, y)
                    break
                case &#x27;mouseup&#x27;:
                    this.send(makeCanvasInfo({
                        type: this.type,
                        ox: canvas.penOriginPoint[0] / this.WIDTH,
                        oy: canvas.penOriginPoint[1] / this.HEIGHT,
                        ex: x / this.WIDTH,
                        ey: y / this.HEIGHT,
                        width: canvas.width / this.WIDTH,
                        color: canvas.color
                    }))
                    canvas.penOriginPoint = null
                    canvas.lastImageData = null
                    break
            }
        },
        /**
         *实施画圆的操作
         *@event commandcircle
         *@param {String} action，操作的名称，&#x27;mousemove&#x27;, &#x27;mousedown&#x27;, &#x27;mouseup&#x27;
         *@param {Object} { x, y, buttons }
         */
        commandcircle (action, { x, y, buttons }) {
            this.initPenProperty()
            const canvas = this.canvas
            this.setProperty(canvas.width, canvas.color.hex, canvas.color.a)
            switch (action) {
                case &#x27;mousedown&#x27;:
                    canvas.penOriginPoint = [x, y]
                    canvas.lastImageData = this.context.getImageData(0, 0, this.WIDTH, this.HEIGHT)
                    break
                case &#x27;mousemove&#x27;:
                    if (canvas.penOriginPoint == null) {
                        return
                    }
                    this.context.putImageData(canvas.lastImageData, 0, 0)
                    const [ ox, oy ] = canvas.penOriginPoint
                    this.drawCircle(ox, oy, x, y, canvas.isFill)
                    break
                case &#x27;mouseup&#x27;:
                    this.send(makeCanvasInfo({
                        type: this.type,
                        ox: canvas.penOriginPoint[0] / this.WIDTH,
                        oy: canvas.penOriginPoint[1] / this.HEIGHT,
                        ex: x / this.WIDTH,
                        ey: y / this.HEIGHT,
                        width: canvas.width / this.WIDTH,
                        color: canvas.color,
                        isFill: canvas.isFill
                    }))
                    canvas.penOriginPoint = null
                    canvas.lastImageData = null
                    break
            }
        },
        /**
         *实施画矩形的操作
         *@event commandrect
         *@param {String} action，操作的名称，&#x27;mousemove&#x27;, &#x27;mousedown&#x27;, &#x27;mouseup&#x27;
         *@param {Object} { x, y, buttons }
         */
        commandrect (action, { x, y, buttons }) {
            this.initPenProperty()
            const canvas = this.canvas
            this.setProperty(canvas.width, canvas.color.hex, canvas.color.a)
            switch (action) {
                case &#x27;mousedown&#x27;:
                    canvas.penOriginPoint = [x, y]
                    canvas.lastImageData = this.context.getImageData(0, 0, this.WIDTH, this.HEIGHT)
                    break
                case &#x27;mousemove&#x27;:
                    if (canvas.penOriginPoint == null) {
                        return
                    }
                    this.context.putImageData(canvas.lastImageData, 0, 0)
                    const [ ox, oy ] = canvas.penOriginPoint
                    this.drawRect(ox, oy, x, y, canvas.isFill)
                    break
                case &#x27;mouseup&#x27;:
                    this.send(makeCanvasInfo({
                        type: this.type,
                        ox: canvas.penOriginPoint[0] / this.WIDTH,
                        oy: canvas.penOriginPoint[1] / this.HEIGHT,
                        ex: x / this.WIDTH,
                        ey: y / this.HEIGHT,
                        width: canvas.width / this.WIDTH,
                        color: canvas.color,
                        isFill: canvas.isFill
                    }))
                    canvas.penOriginPoint = null
                    canvas.lastImageData = null
                    break
            }
        },
        /**
         *实施橡皮擦的操作
         *@event commandrubber
         *@param {String} action，操作的名称，&#x27;mousemove&#x27;, &#x27;mousedown&#x27;, &#x27;mouseup&#x27;
         *@param {Object} { x, y, buttons }
         */
        commandrubber (action, { x, y, buttons }) {
            this.initPenProperty()
            const canvas = this.canvas
            switch (action) {
                case &#x27;mousedown&#x27;:
                    canvas.penOriginPoint = [x, y]
                    break
                case &#x27;mousemove&#x27;:
                    if (buttons !== 1) {
                        return
                    }
                    this.setProperty(Math.floor(canvas.width * 2), &#x27;white&#x27;, 1)
                    const [ox, oy] = canvas.penOriginPoint
                    this.drawLine(ox, oy, x, y)
                    this.send(makeCanvasInfo({
                        type: this.type,
                        ox: ox / this.WIDTH,
                        oy: oy / this.HEIGHT,
                        ex: x / this.WIDTH,
                        ey: y / this.HEIGHT,
                        width: canvas.width / this.WIDTH
                    }))
                    canvas.penOriginPoint = [x, y]
                    break
                case &#x27;mouseup&#x27;:
                    canvas.penOriginPoint = null
                    break
            }
        },
        /**
         *实施文本框的操作
         *@event commandtext
         *@param {String} action，操作的名称，&#x27;mousemove&#x27;, &#x27;mousedown&#x27;, &#x27;mouseup&#x27;
         *@param {Object} event
         */
        commandtext (action, event) {
            this.initPenProperty()
            const canvas = this.canvas
            this.setProperty(canvas.width, canvas.color.hex, canvas.color.a)
            switch (action) {
                case &#x27;mousedown&#x27;:
                    if (this.canvas.isInput === true) {
                        this.putText()
                    } else {
                        this.canvas.text = &#x27;&#x27;
                        this.canvas.isInput = true
                        this.canvas.penOriginPoint = [event.x, event.y]
                    }
                    this.position.left = (event.x + this.$refs.board.offsetLeft).toString() + &#x27;px&#x27;
                    this.position.top = (event.y + this.$refs.board.offsetTop - 12).toString() + &#x27;px&#x27;
                    break
            }
        },
        /**
         *调用drawText函数，并且发送makeCanvasInfo消息
         *@event putText
         */
        putText () {
            const canvas = this.canvas
            if (canvas.isInput) {
                this.context.lineWidth = 1
                const [ox, oy] = canvas.penOriginPoint
                this.drawText(ox, oy, canvas.fontSize, canvas.text, canvas.isFill)
                this.send(makeCanvasInfo({
                    type: this.type,
                    ox: ox / this.WIDTH,
                    oy: oy / this.HEIGHT,
                    fontSize: canvas.fontSize / this.WIDTH,
                    color: canvas.color,
                    isFill: canvas.isFill,
                    text: canvas.text
                }))
                this.canvas.isInput = false
                // this.$refs.text.focus()
            }
        },

        /**
         *调用drawClear函数，并且发送makeCanvasInfo消息（type为&#x27;clear&#x27;）
         *@event clearBoard
         */
        clearBoard () {
            this.drawClear()
            this.send(makeCanvasInfo({
                type: &#x27;clear&#x27;
            }))
        },

        /**
         *画图，处理&#x27;pen&#x27;,&#x27;line&#x27;,&#x27;circle&#x27;,&#x27;rect&#x27;等信息
         *@event draw
         *@param {Object} canvasInfo，画板的相关信息
         */
        draw (canvasInfo) {
            switch (canvasInfo.type) {
                case &#x27;pen&#x27;:
                    this.context.lineCap = (canvasInfo.color.a &lt; 1) ? &#x27;butt&#x27; : &#x27;round&#x27;
                case &#x27;line&#x27; :
                    this.setProperty(canvasInfo.width * this.WIDTH, canvasInfo.color.hex, canvasInfo.color.a)
                    this.drawLine(canvasInfo.start[0] * this.WIDTH, canvasInfo.start[1] * this.HEIGHT, canvasInfo.end[0] * this.WIDTH, canvasInfo.end[1] * this.HEIGHT)
                    break
                case &#x27;circle&#x27;:
                    this.setProperty(canvasInfo.width * this.WIDTH, canvasInfo.color.hex, canvasInfo.color.a)
                    this.drawCircle(canvasInfo.start[0] * this.WIDTH, canvasInfo.start[1] * this.HEIGHT, canvasInfo.end[0] * this.WIDTH, canvasInfo.end[1] * this.HEIGHT, canvasInfo.isFill)
                    break
                case &#x27;rect&#x27;:
                    this.setProperty(canvasInfo.width * this.WIDTH, canvasInfo.color.hex, canvasInfo.color.a)
                    this.drawRect(canvasInfo.start[0] * this.WIDTH, canvasInfo.start[1] * this.HEIGHT, canvasInfo.end[0] * this.WIDTH, canvasInfo.end[1] * this.HEIGHT, canvasInfo.isFill)
                    break
                case &#x27;rubber&#x27;:
                    this.setProperty(canvasInfo.width * 2 * this.WIDTH, &#x27;white&#x27;, 1)
                    this.drawLine(canvasInfo.start[0] * this.WIDTH, canvasInfo.start[1] * this.HEIGHT, canvasInfo.end[0] * this.WIDTH, canvasInfo.end[1] * this.HEIGHT)
                    break
                case &#x27;text&#x27;:
                    this.setProperty(1, canvasInfo.color.hex, canvasInfo.color.a)
                    this.drawText(canvasInfo.start[0] * this.WIDTH, canvasInfo.start[1] * this.HEIGHT, canvasInfo.fontSize * this.WIDTH, canvasInfo.text, canvasInfo.isFill)
                    break
                case &#x27;history&#x27;:
                    console.log(canvasInfo)
                    let that = this
                    var image = new Image()
                    image.onload = function () {
                        that.context.drawImage(image, 0, 0, that.WIDTH, that.HEIGHT) // Or at whatever offset you like
                    }
                    image.src = canvasInfo.canvas
                    break
                case &#x27;clear&#x27;:
                    this.drawClear()
            }
        }
    },
    mounted () {
        this.$refs.board.width = this.WIDTH
        this.$refs.board.height = this.HEIGHT
        if (this.AUTHORITY) {
            [&#x27;mousemove&#x27;, &#x27;mousedown&#x27;, &#x27;mouseup&#x27;].map((eventName) =&gt; {
                this.$refs.board.addEventListener(eventName, ({ offsetX: x, offsetY: y, buttons }) =&gt; {
                    this[&#x60;command${this.type}&#x60;](eventName, { x, y, buttons })
                })
            })
        }
        this.context = this.$refs.board.getContext(&#x27;2d&#x27;)
    }
}
&lt;/script&gt;

&lt;style scoped&gt;
    #canvas #relative {
        width: 0;
        height: 0;
        float: left;
    }

    #canvas #tool-button {
        position: relative;
        top: 5px;
        left: 5px;
        z-index: 400;
        color: #5cadff;
        cursor: pointer;
    }

    #canvas{
        width: 100%;
        height: 100%;
    }

    #canvas #draw-board {

    }
    #canvas #board {
        cursor: url(/static/img/dot.ico),auto;
    }
    #canvas .buttons {
        display: inline-block;
    }

    #canvas #tool-button:hover {
        color: gray;
    }
    #canvas #tool-bar{
        padding-left: 50px;
        padding-top: 5px;
        padding-bottom: 5px;
        padding-right: 5px;
	}
&lt;/style&gt;

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
